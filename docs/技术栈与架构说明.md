# 问卷系统 - 技术栈与架构说明

本问卷项目采用与团队其他项目（如 AI Plugin）**一致的技术栈**，便于统一技术选型与协作。  
**定位**：**单校部署，不涉及多租户**；权限与数据范围按**院系 + 角色**划分。

---

## 一、技术栈概览

### 1.1 前端（管理端 + 填写端）

| 类别 | 技术 | 说明 |
|------|------|------|
| 框架 | **Next.js 16** | App Router，端口可自定（如 4000），basePath 按部署配置；Turbopack 稳定版默认 |
| 语言 | **TypeScript** | 全项目 TS |
| UI | **React 19** | 函数组件 |
| 样式 | **Tailwind CSS 3** | 含 tailwindcss-animate、自定义色板（primary/success/warning/danger 等） |
| HTTP / 状态 | **Axios** + **TanStack React Query** | 请求封装、baseURL 与 rewrites 代理到后端；服务端状态与缓存 |
| 组件与交互 | **Radix UI**、**lucide-react** / **react-icons**、**framer-motion**、**react-hot-toast** | 无样式基元、图标、动效、Toast |
| 工具类 | **clsx**、**tailwind-merge**、**class-variance-authority** | 类名合并与变体 |
| 校验 | **Zod** | 表单与请求体校验 |
| Mock | **MSW** | 本地开发 Mock（可选） |
| 规范 | **ESLint** + **eslint-config-next** | 代码规范 |

**路由与结构**：`src/app/` 下按功能分页（如我的问卷、编辑、发放、统计、设置、填写页等）；布局用 `layout.tsx`；API 集中封装在 `src/services/api.ts`，类型在 `@/types`。

### 1.2 后端（问卷业务 API）

| 类别 | 技术 | 说明 |
|------|------|------|
| 框架 | **Spring Boot 3.4.x** | Java 17+，Servlet 栈（当前 3.x 最新稳定；4.x 已发布可按需升级） |
| Web | **spring-boot-starter-web** + **spring-boot-starter-validation** | REST API、请求体验证 |
| 安全 | **Spring Security** + **JWT (jjwt)** | 登录、鉴权、CORS；对接高校 CAS 时由 CAS 与 Session/JWT 配合 |
| 数据层 | **MySQL 8** + **MyBatis-Plus 3.5.x** | 主库；mapper 在 `classpath:/mapper/*.xml`，逻辑删除等 |
| 缓存 | **Spring Data Redis (Lettuce)** | 会话、缓存、限流等（按需） |
| 数据库迁移 | **Flyway 风格** | `src/main/resources/db/migration/V*__*.sql` |
| 文档 | **Springdoc OpenAPI** | REST API 文档（Swagger UI） |
| 工具 | **Lombok**、**Apache Commons**、**Jackson** | 实体与工具方法、JSON |

**与多租户项目的差异**：不引入 TenantContext、租户 Filter、多租户数据隔离；不依赖 Spring AI / RAG / 向量库等，除非后续做 AI 辅助功能。

---

## 二、后端架构风格

- **分层**：Controller → Service → Mapper/Entity；统一响应体 `Result<T>`；全局异常处理（`@RestControllerAdvice`）。
- **包结构**：controller、service、mapper/entity、vo/dto、config、common、util 等；**无**租户相关 config/Filter。
- **认证**：高校以 **CAS 统一身份**为主，本地账号为辅；Session 或 JWT，无租户解析。
- **权限**：按**院系 + 角色**（校管 / 院系管理员 / 普通用户）做数据范围与操作权限控制。
- **API 风格**：RESTful（如 `/api/surveys`、`/api/responses`）；统一 `Result<T>`；异常统一错误响应。
- **部署**：JAR + Docker（可选）；单校单实例或多实例无状态，无需租户路由或按租户切换数据源。

---

## 三、前后端协作

- **开发**：前端 `next dev`（端口如 4000），后端 `spring-boot:run` 或 jar（端口如 8080）；前端通过 Next.js `rewrites` 将 `/api/*` 转到后端。
- **认证**：前端登录后持有 Session 或 Token，请求携带 Cookie 或 Authorization；后端无租户解析。
- **类型与契约**：前端 `@/types` 与后端 VO/DTO 对应；可依赖 Springdoc 导出 OpenAPI 做对齐或生成。
- **Mock**：前端 MSW 可拦截 `/api/*`，在不启后端时开发 UI。

---

## 四、与功能规格的对应

- 功能规格中的「**租户**」相关描述**不采用**：本系统不实现多租户，不做租户级数据隔离与配置隔离。
- 保留并实现：**院系**（校内组织树）、**角色与权限**、**数据权限分级与审计**、**CAS 与用户体系对接**、**操作日志**等，均在**单校**前提下设计。
- 若未来需支持多校，可在表结构中预留 `school_id` 或类似字段做扩展，但不作为首版能力。

---

## 五、小结

| 维度 | 说明 |
|------|------|
| **技术栈** | Next.js 16 + React 19 + TypeScript + Tailwind + Axios + React Query + Radix 等 \| Spring Boot 3.4 + Java 17+ + MyBatis-Plus + MySQL + Redis + JWT + Spring Security |
| **多租户** | **不涉及**；单校部署，权限与数据按院系 + 角色划分 |
| **架构** | 前端 App Router 单页、集中 API 封装；后端分层 REST、统一 Result、Flyway 迁移 |
