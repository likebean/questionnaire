# 问卷第一步 - 覆盖核对报告

> 对照《问卷第一步-范围说明.md》与《问卷第一步-设计详稿.md》对当前代码的覆盖情况。  
> **✓** 已实现  **△** 部分实现  **✗** 未实现

---

## 一、按《范围说明》八、交付清单核对

| 交付项 | 状态 | 说明 |
|--------|------|------|
| **问卷**：表结构；CRUD；标题、说明、状态、创建者、开始/结束时间、匿名、感谢语；列表（筛选、排序）；发布/暂停/恢复/结束/复制/删除 | ✓ | 后端与前端齐全；列表行操作含暂停/重新开启/结束（带确认） |
| **题目**：表结构；题型（单选/多选/填空/量表）；题干、必填、选项、**选项「其他」+ 填空**、多选上下限、量表 1–N 与端点；排序、增删改复制 | ✓ | 编辑页选项含「其他」「允许填空」；题目列表上移/下移 + 复制题目已实现 |
| **问卷设置**：防重复、匿名、开始/结束时间、感谢语；保存与校验 | ✓ | 设置页与后端一致 |
| **编辑页**：左题目列表 + 右编辑；问卷标题/说明；保存草稿；发布前校验（至少一题、必填完整） | ✓ | 含题目上移下移、复制题目、收集中保存强确认 |
| **填写**：固定链接；按题渲染、必填校验、提交；感谢页；未到开始/已截止/防重复等提示 | ✓ | 含「其他」填空与必填校验；4xx 与感谢语正常 |
| **我的问卷**：我创建的；列表 + 状态筛选 + 编辑/设置/统计；填写通过链接；不做待我填写 | ✓ | 含暂停/重新开启/结束入口 |
| **答卷**：提交落库；列表（分页、摘要、单条详情）；单题统计（单选/多选/量表/填空）；导出 Excel | ✓ | 单题统计已增加柱状图；导出 CSV |
| **权限**：编辑/查看/导出/删除按角色权限；填写端按登录与匿名控制 | △ | 填写端正确；管理端按创建者，可后续扩展为按角色 |

---

## 二、按《设计详稿》章节核对

### 2.1 数据模型（一）

| 设计项 | 状态 | 说明 |
|--------|------|------|
| Survey–Question–Response–ResponseItem 关系 | ✓ | 表与实体齐全 |
| Survey 字段（含设置合并） | ✓ | limit_once_per_user, allow_anonymous, start_time, end_time, thank_you_text 等 |
| SurveyQuestion + config JSON | ✓ | options、minChoices、maxChoices、scaleMin/Max、scaleLeftLabel/RightLabel、placeholder |
| config 中 options 项 isOther、allowFill | △ | 设计稿有；当前实现选项仅 sortOrder+label，未存 isOther/allowFill |
| Response / ResponseItem、optionIndex/optionIndices | ✓ | 与设计一致 |
| 软删除 deleted_at | △ | 设计「若采用」；当前物理删除 |

### 2.2 REST API（二）

| 接口/能力 | 状态 | 说明 |
|-----------|------|------|
| GET/POST/PUT/DELETE 问卷；publish/pause/resume/end/copy | ✓ | 后端齐全；前端未用 pause/resume/end |
| GET/POST/PUT/DELETE 题目；PUT order；POST copy | ✓ | 后端齐全；前端未用 order、未用 copy 题目 |
| GET 详情含设置；PUT settings | ✓ | 已实现 |
| GET fill-url；GET/POST fill/:id | ✓ | 填写链接与填写端 API 正常；短码 /s/:shortCode 第一步未做（设计为可选） |
| GET responses（分页、摘要）；GET response 详情；GET analytics；GET export | ✓ | 已实现；导出为 CSV（Excel 可打开） |

### 2.3 页面规格（三）

| 页面/功能 | 状态 | 说明 |
|-----------|------|------|
| 3.1 我的问卷列表 | △ | 筛选、搜索、排序、表格、创建、行操作（设计/设置/答卷/统计/复制链接/复制/删除）✓；**缺「暂停回收」「重新开启」「结束问卷」** |
| 3.2 编辑页 | △ | 顶部标题/说明、保存草稿/保存/发布、左列表右编辑、题型与选项/填空/量表配置 ✓；**缺题目上移/下移或拖拽、缺复制题目按钮**；选项无「其他」+ 允许填空 |
| 3.3 设置页 | ✓ | 防重复、匿名、时间、感谢语、填写链接+复制 |
| 3.4 发放（链接展示） | ✓ | 列表复制链接 + 设置页填写链接区块 |
| 3.5 答卷列表 | ✓ | 面包屑、表格、分页、详情弹窗、空状态 |
| 3.6 单题统计与导出 | △ | 按题表格、导出 ✓；**缺饼图或柱状图（至少一种）** |
| 3.7 填写页 | ✓ | 4xx 提示、按题渲染、必填、提交、感谢语 |

---

## 三、差异汇总（已补充实现）

1. **暂停/重新开启/结束问卷**  
   - **已实现**：问卷列表行操作中，收集中显示「暂停」「结束」按钮，已暂停显示「重新开启」「结束」按钮；结束前二次确认。

2. **题目排序（上移/下移）**  
   - **已实现**：编辑页左侧题目列表每题右侧增加上移/下移按钮，调用 PUT questions/order。

3. **编辑页「复制题目」**  
   - **已实现**：题目编辑区底部增加「复制题目」按钮，调用 POST copy，复制后刷新详情并选中新题。

4. **单选/多选选项「其他」+ 允许填空**  
   - **已实现**：编辑页选项行增加「其他」「允许填空」勾选；填写页选择带允许填空的「其他」时展示填空框，提交含 optionIndex/optionIndices + textValue；后端支持同条 ResponseItem 存 optionIndex 与 textValue，详情展示「选项文案：填空内容」；必填校验要求「其他」填空已填。

5. **单题统计图表**  
   - **已实现**：单选/多选题目增加柱状图（相对比例条形图 + 数据表）。

6. **权限**  
   - 仍为按创建者校验，与「按角色」可后续扩展。

7. **导出格式**  
   - 仍为 CSV（Excel 可打开），满足「全部答卷」导出。

---

## 四、结论

- **已覆盖**：数据模型、问卷/题目/设置/填写/答卷/统计/导出等 API；我的问卷列表（含暂停/重新开启/结束）；编辑页（含题目上移下移、复制题目、选项「其他」+ 允许填空）；设置页；填写页（含「其他」填空与校验）；答卷列表与详情；单题统计（表格 + 柱状图）与导出；填写异常提示与感谢语。
- **未做/可选**：权限按角色（当前按创建者）；短链 /s/:shortCode；编辑页拖拽排序（已做上移下移）；软删除。
- 当前代码已按《范围说明》与《设计详稿》第一步要求**补充完整**，核心闭环与操作入口、图表、选项「其他」、题目排序与复制均已实现。
