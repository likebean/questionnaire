# 问卷第三步 - 范围说明

> **原则**：整体共 3 步。第一步为基础闭环，第二步为逻辑、题型与统计增强；**第三步**为进阶能力与运维，实现功能规格中尚未覆盖的其余项，可按优先级再拆子阶段实施。

**第三步目标**：在第一步、第二步完成后，本步实现：**逻辑与题型进阶**（反向关联、随机抽题、循环题、变量与公式、评分逻辑、条件嵌套；比重题、上传文件、表格题、投票题、多级下拉等）；**问卷设置与发放进阶**（配额规则、答题时间控制、问卷密码、每日配额等）；**外观与展示**（主题、进度条、编号样式、显示项）；**模板与复用**（从模板创建、从文本导入、题库）；**答卷与统计进阶**（自定义查询、多维度分类、按地区/渠道、导出版本号、统计快照、调查报告）；**权限与运维**（操作日志与审计、数据权限与脱敏）；**考试与测评**（限时、题库、阅卷、防切屏等）；**集成与扩展**（API/Webhook、AI 辅助等）。实施时可按业务优先级分多期完成，不必一次全部上线。

---

## 一、与第一步、第二步的关系（沿用与新增）

| 维度 | 第一步 | 第二步 | 第三步 |
|------|--------|--------|--------|
| 问卷基础与状态 | 四态、发布/暂停/结束/复制/删除 | 沿用 | **沿用** |
| 题型 | 单选、多选、填空、量表 | + 下拉、矩阵、排序、日期、时间、段落、分页符 | **+ 比重、上传、表格、投票、多级下拉等**（按需） |
| 逻辑 | 无 | 跳题、显隐、选项显隐、选项引用、必填、多条件 | **+ 反向关联、随机抽题、循环题、公式、评分、条件嵌套** |
| 问卷设置 | 防重复/匿名/时间/感谢语 | + 分页、单次限时、最大回收数 | **+ 配额规则、答题时间控制、问卷密码、每日配额等** |
| 外观 | 无 | 无 | **主题、进度条、编号样式、显示项** |
| 答卷与统计 | 列表、单题统计、导出 | + 标记无效、编辑、分类统计、交叉分析 | **+ 自定义查询、多维度分类、按地区/渠道、版本号、快照、调查报告、高级分析** |
| 模板与复用 | 复制问卷 | 复制含逻辑与题型 | **从模板创建、从文本导入、题库** |
| 权限与运维 | 创建者归属 | 沿用 | **操作日志与审计、数据权限与脱敏、协作与转移**（按需） |
| 考试与集成 | 无 | 无 | **考试/测评模块、API/Webhook、AI**（按需） |

---

## 二、逻辑与题型进阶（对应功能规格 三、3.5、3.2）

### 2.1 逻辑进阶（第三步）

| 功能点 | 规格出处 | 第三步说明 |
|--------|----------|------------|
| 反向关联 | 3.5 | 后续题目反向关联到前面题目，用于特殊逻辑 |
| 随机抽题 | 3.5 | 从题目池/题库随机抽取 N 题展示；考试/测评常用 |
| 循环题（Repeat） | 3.5 | 根据前题答案或固定次数循环展示同一题或题组 |
| 变量与公式计算 | 3.5、3.3 | 变量存储中间结果，公式计算用于赋值、得分、显隐条件 |
| 评分逻辑与自动判分 | 3.5 | 题目/选项配置分值，自动判分、按维度汇总；考试与测评必备 |
| 条件嵌套逻辑 | 3.5 | 多级条件组合（若 A 且 B 则显示 C；若 A 且非 B 则跳转…） |

### 2.2 题型进阶（第三步，按需选取）

| 题型/能力 | 规格出处 | 第三步说明 |
|-----------|----------|------------|
| 比重题 | 3.2.1 | 若干项分配比例（如总和 100%） |
| 上传文件题 | 3.2.1、3.4 | 单/多文件，类型与大小限制 |
| 表格题 | 3.2.1 | 自定义行列的表格填空/选择 |
| 投票题 | 3.2.1 | 单选但按选项计票展示 |
| 多级下拉 | 3.2.1 | 省市区、层级选项联动 |
| 段落说明增强 | 3.2.1 | 支持图片/富文本（若第二步仅文字） |

---

## 三、问卷设置与发放进阶（对应功能规格 三、3.6；四、4.5、4.6）

| 功能点 | 规格出处 | 第三步说明 |
|--------|----------|------------|
| 配额规则 | 3.6、4.5.2 | 按某题某选项设定「该选项最多被选 N 次」；交叉配额、高级配额等 |
| 每日配额 | 4.5.1 | 按自然日限制每日最大回收数 |
| 答题时间控制 | 3.6、4.6 | 设置填写最少时间，过短可自动标记无效 |
| 问卷密码 | 3.6 | 填写前需输入问卷密码 |
| 质量控制 | 4.6 | 重复答卷筛选、自动筛选（根据答案筛无效）等 |

---

## 四、外观与展示（对应功能规格 三、3.7）

| 功能点 | 规格出处 | 第三步说明 |
|--------|----------|------------|
| 显示项 | 3.7 | 是否显示问卷标题、上一页、二维码、题型标签等 |
| 进度条 | 3.7 | 按题目数或按分页显示进度；位置与样式可配 |
| 主题与样式 | 3.7 | 主题色、字体、字号；电脑端与手机端可分别设计 |
| 题目编号 | 3.7 | 数字、字母、无编号等 |
| 按钮文案 | 3.7 | 提交、上一页/下一页按钮文字可自定义 |
| 水印 | 3.7 | 针对填写者的特有水印（防作弊/溯源） |

---

## 五、模板与复用（对应功能规格 六）

| 功能点 | 规格出处 | 第三步说明 |
|--------|----------|------------|
| 从模板创建 | 6.1、6.2 | 按应用类型或行业选择模板，基于模板生成新问卷；系统内置/个人/院内模板库 |
| 从文本导入 | 6.1 | 从 Word/Excel 粘贴或按约定格式导入题目 |
| 题库 | 3.8、6.4 | 个人/企业题库，从题库选题插入问卷；分类、标签、搜索 |
| 企业/校内模板库 | 6.3 | 管理员维护统一模板，成员引用；可见范围与引用权限 |

---

## 六、答卷与统计进阶（对应功能规格 五）

| 功能点 | 规格出处 | 第三步说明 |
|--------|----------|------------|
| 自定义查询 | 5.5 | 多条件组合筛选答卷子集；基于查询结果查看、导出、分享 |
| 多维度分类 | 5.2 | 按「部门+性别」等多维度组合得到细分统计 |
| 按地区/来源分类 | 5.2 | 按 IP 省份/城市、来源渠道统计 |
| 导出版本号与统计快照 | 5.1、5.6 | 导出时记录版本号；统计结果快照（按某时刻筛选条件固化） |
| 调查报告 | 5.6 | 将统计结果（含图表、分类、交叉）生成 Word/PDF 报告 |
| 条件筛选分析 | 5.7 | 统计/交叉分析前先按条件筛选答卷子集 |
| 高级分析 | 5.7 | 多问卷分析、时间趋势、对比分析、权重与加权、数据大屏等（按需） |

---

## 七、权限、日志与审计（对应功能规格 二、2.5、2.8）

| 功能点 | 规格出处 | 第三步说明 |
|--------|----------|------------|
| 操作日志与审计 | 2.5、2.8、5.1 | 创建/编辑/发布/导出/删除等关键操作留痕；编辑答卷保留修改记录；区分登录、导出、编辑、删除、权限变更等日志级别 |
| 数据权限与脱敏 | 2.8 | 可见范围（仅创建者/团队/指定成员）；导出脱敏（IP、手机号等）；字段级脱敏策略、按角色控制 |
| 问卷转移归属 | 2.5 | 创建者可将问卷转移给其他用户或院系 |
| 团队协作编辑 | 2.5 | 多人协作编辑（指定成员可编辑/只读）；编辑锁、最后保存覆盖提示（可选） |

---

## 八、考试与测评、集成与扩展（对应功能规格 三、3.12；四；二、2.9）

| 功能点 | 规格出处 | 第三步说明 |
|--------|----------|------------|
| 考试模式 | 3.12 | 限时、倒计时、随机抽题、题目/选项乱序 |
| 题库与组卷 | 3.12 | 题目入库、按知识点/难度分类、组卷规则（抽题数量、分值） |
| 阅卷与判分 | 3.12 | 自动判分（客观题）、主观题 AI 或人工阅卷；评分逻辑、维度得分、总分 |
| 防作弊 | 四、4.6 | 验证码、答题时长检测、异常检测、防切屏等（与考试配合） |
| API 与 Webhook | 2.9 | 问卷/题目/答卷 CRUD、统计、导出；答卷提交、状态变更等事件回调 |
| AI 辅助 | 3.10 | AI 生成题目/选项、翻译、简答题阅卷、报告摘要等（按需） |

---

## 九、对功能规格的完整覆盖（可选/按需项）

三步合起来已覆盖《功能规格.md》主体能力。以下为**可选或按需**补充项，便于与功能规格逐条对齐；详见《三步对功能规格覆盖检查.md》。

| 规格章节 | 建议补充（第三步可选/按需） |
|----------|------------------------------|
| **一、用户与账号** | 第一步或总则注明「依赖现有用户与 CAS 登录」。 |
| **二、高校对接** | 2.4 按身份/院系控制；2.7 运维与安全（备份与恢复）；2.10 院系与权限模型（角色、院系树、数据范围）。 |
| **三、问卷编辑** | 3.1 问卷封面图、应用类型；3.5 管道引用（题干引用前题答案）；3.6 提交后跳转链接、自定义感谢页；3.8 批量替换问卷内容、一键录入/代录。 |
| **四、发放与回收** | 4.1 二维码与海报、iframe 嵌入、自定义来源参数、预填、免登录链接；4.2 短信/邮件/微信邀请（可不纳入或 P3）；4.7 断点续答、每题自动保存、允许修改已提交答卷、错误提示可自定义；4.8 回收监控与答卷来源分析；4.9 样本管理（名单、状态、完成率）。 |
| **五、数据与统计** | 5.1 数据合并导入（Excel 补充答卷）、分享特定条件数据；5.10 数据归档（归档后只读）、加密存储、子账号数据视图；5.7 大数据量策略（异步统计、缓存、流式导出）。 |
| **六、模板与复用** | 6.7 多层级文件夹（问卷分类管理）。 |
| **七、其他** | 7.3 管理端（平台管理员、基础统计）；7.6 系统通知（问卷结束、配额达上限、导出完成等）。 |

---

## 十、第三步交付清单（开发可勾选，按优先级分期）

- [ ] **逻辑进阶**：反向关联、随机抽题、循环题、变量与公式、评分逻辑、条件嵌套（按需选取）。
- [ ] **题型进阶**：比重题、上传文件、表格题、投票题、多级下拉等（按需选取）。
- [ ] **问卷设置与发放**：配额规则、每日配额、答题时间控制、问卷密码、质量控制。
- [ ] **外观**：主题、进度条、编号样式、显示项、按钮文案、水印。
- [ ] **模板与复用**：从模板创建、从文本导入、题库；企业/校内模板库（可选）。
- [ ] **答卷与统计进阶**：自定义查询、多维度分类、按地区/来源、导出版本号与快照、调查报告、条件筛选分析、高级分析（按需）。
- [ ] **权限与运维**：操作日志与审计、数据权限与脱敏、问卷转移、团队协作（按需）。
- [ ] **考试与测评**：考试模式、题库与组卷、阅卷与判分、防作弊（按需）。
- [ ] **集成与扩展**：API、Webhook、AI 辅助（按需）。
- [ ] **覆盖检查中的可选/按需项**：见「九、对功能规格的完整覆盖」及《三步对功能规格覆盖检查.md》。

---

**文档状态**：整体共 3 步。本文档为第三步范围（逻辑与题型进阶、配额与外观、模板与题库、统计进阶、权限与运维、考试与集成），用于评审与排期；实施时可按业务优先级拆为多期，不必一次全部完成。三步与《功能规格.md》的逐条对照见《三步对功能规格覆盖检查.md》。
