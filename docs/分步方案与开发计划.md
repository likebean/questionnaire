# 问卷系统 - 分步方案与开发计划

按**模块**分步推进：每个模块内先做**本模块的库表与接口设计**，再做**本模块的代码实现**，不在一开始统一设计所有模块的库表与接口。

---

## 分步总览（按模块）

| 步骤 | 模块 | 本步设计内容 | 本步实现内容 |
|------|------|--------------|--------------|
| **1** | 基础骨架 | 端口、代理、健康检查 | 后端 + 前端项目可运行、前后端打通 |
| **2** | 用户与认证 | 用户表、登录/会话、本模块接口 | 注册/登录/登出、个人中心、我的问卷入口（列表可空） |
| **3** | 问卷与题型 | 问卷/题目/选项表、本模块接口 | 问卷 CRUD、题目 CRUD、P0 题型编辑与存储 |
| **4** | 填写与回收 | 答卷表、防重复策略、本模块接口 | 填写页、提交、防重复、答卷列表 |
| **5** | 统计与导出 | 统计口径、导出格式、本模块接口 | 单题统计图表、Excel/CSV 导出 |
| **6** | P1 增强 | 逻辑跳题、更多题型、状态与复制设计 | 逻辑跳题、更多题型、问卷状态与复制 |

P2（模板、题库、院系权限与审计等）在 P0/P1 稳定后再排期。

---

## 步骤 1：基础骨架

**目标**：后端与前端项目可本地启动，请求能从前端发到后端并返回。

### 本步设计

- 后端端口（如 8080）、前端端口（如 3000）、Next.js rewrites 将 `/api/*` 代理到后端。
- 后端：Spring Boot 3.4、连接 `questionnaire` 库、健康检查接口、统一 `Result`、全局异常；暂不建业务表。

### 本步实现

- 新建 Spring Boot 项目，配置 `application.yml` 连接 MySQL `questionnaire`，加入 MyBatis-Plus、Flyway（空或仅占位）。
- 新建 Next.js 16 前端，配置 rewrites 代理 `/api` 到后端，Axios baseURL 为 `/api`。
- 后端提供 `GET /api/health`，前端调用并展示结果。

---

## 步骤 2：用户与认证

**目标**：本地注册/登录可用，个人中心与「我的问卷」入口可访问（问卷列表可先返回空）。

### 本步设计（仅本模块）

- **库表**：用户表（id、账号、密码哈希、昵称、邮箱等、CAS 标识预留、创建/更新时间）；如需 Session 可加会话表，或采用 JWT 无表。
- **接口**：注册、登录、登出、当前用户信息；CAS 仅预留配置与回调路径说明。

### 本步实现

- Flyway 迁移：仅用户表（及可选会话表）。
- 后端：注册/登录/登出/当前用户接口；密码 BCrypt。
- 前端：登录页、注册页、布局（含登出）、「我的问卷」页（调用问卷列表接口，后端暂返回空数组）。

---

## 步骤 3：问卷与题型（P0）

**目标**：能创建/编辑/删除问卷，能添加/编辑/删除题目，支持 P0 题型（单选、多选、填空、多行填空、量表、描述、分页）。

### 本步设计（仅本模块）

- **库表**：问卷表（标题、说明、状态、创建者、开始/结束时间、最大回收数、感谢语等）；题目表（问卷 id、题型、题干、必填、排序、逻辑配置 JSON 等）；选项表（题目 id、选项文案、排序、跳题目标等）。题型枚举与前端组件对应。
- **接口**：问卷列表（分页、筛选）、创建、详情、更新、删除；题目列表（按问卷）、题目新增/更新/删除/排序。

### 本步实现

- Flyway 迁移：问卷表、题目表、选项表。
- 后端：问卷 CRUD、题目 CRUD 接口。
- 前端：问卷列表（含新建）、问卷编辑页（标题/说明、题目列表、按题型渲染编辑组件、必填/选项随机等）。

---

## 步骤 4：填写与回收

**目标**：填写链接可打开问卷、按题作答、提交成功；防重复（设备或用户）；答卷列表可查看。

### 本步设计（仅本模块）

- **库表**：答卷主表（问卷 id、提交时间、填写人 id 可选、防重复标识等）；答卷明细表（答卷 id、题目 id、答案存储，如 JSON 或键值）。
- **接口**：填写用—问卷元信息+题目列表（公开或鉴权）；提交答卷；管理端—答卷列表（分页）。
- **策略**：防重复（cookie/本地存储 或 用户 ID）；问卷状态与时间、最大回收数校验规则。

### 本步实现

- Flyway 迁移：答卷主表、答卷明细表。
- 后端：填写入口接口、提交接口、答卷列表接口；防重复与状态/时间/份数校验。
- 前端：填写页 `/s/[id]`、提交成功页、管理端答卷列表页。

---

## 步骤 5：统计与导出

**目标**：单题统计（饼图/柱状图）、导出 Excel/CSV。

### 本步设计（仅本模块）

- **统计**：单题统计口径（选项计数、比例）；接口入参（问卷 id、题目 id 或全部题目）。
- **导出**：导出字段与格式（与答卷明细一致）；大结果集分页或流式导出策略。

### 本步实现

- 后端：单题统计接口、导出 Excel/CSV 接口。
- 前端：统计页图表（Recharts）、导出按钮与下载。

---

## 步骤 6：P1 增强

**目标**：逻辑跳题、更多题型、问卷状态与复制。

### 本步设计（仅本模块）

- **逻辑跳题**：题目逻辑配置结构（跳题条件、目标题号）；填写时下一题计算规则。
- **题型**：下拉单选/多选、矩阵单选、排序、日期、时间等（表结构是否需扩展、选项存储方式）。
- **问卷**：状态流转（发布/结束）、复制（问卷+题目+选项深拷贝）接口与规则。

### 本步实现

- 后端：逻辑引擎、新增题型支持、问卷状态与复制接口。
- 前端：逻辑跳转、新题型编辑与填写组件、状态操作与复制入口。

---

## 执行顺序

按 **1 → 2 → 3 → 4 → 5 → 6** 顺序执行。每步只产出**当前模块**的库表、接口与代码，不提前设计后续模块；后续步骤如需依赖前面已建表或接口，直接使用即可。

若从**步骤 1：基础骨架**开始，下一步可先搭后端与前端工程并打通健康检查。
